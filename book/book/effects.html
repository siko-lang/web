<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Effects - The Siko programming language</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="reference.html"><strong aria-hidden="true">2.</strong> Language reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="modules.html"><strong aria-hidden="true">2.1.</strong> Modules</a></li><li class="chapter-item expanded "><a href="data_types.html"><strong aria-hidden="true">2.2.</strong> Data types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="adt.html"><strong aria-hidden="true">2.2.1.</strong> Algebraic data types</a></li><li class="chapter-item expanded "><a href="record.html"><strong aria-hidden="true">2.2.2.</strong> Records</a></li></ol></li><li class="chapter-item expanded "><a href="functions.html"><strong aria-hidden="true">2.3.</strong> Functions</a></li><li class="chapter-item expanded "><a href="expressions.html"><strong aria-hidden="true">2.4.</strong> Expressions</a></li><li class="chapter-item expanded "><a href="type_classes.html"><strong aria-hidden="true">2.5.</strong> Type classes</a></li><li class="chapter-item expanded "><a href="effects.html" class="active"><strong aria-hidden="true">2.6.</strong> Effects</a></li></ol></li><li class="chapter-item expanded "><a href="memory.html"><strong aria-hidden="true">3.</strong> Memory management</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Siko programming language</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="effects"><a class="header" href="#effects">Effects</a></h1>
<p>Effects are used to describe that the code wants to use an operation with given semantics and type but the implementation of the operation is unknown and will be decided later by the caller. Effects meant to be a way to inject functionality into code with very little boilerplate.
The idea behind effects is that libraries should use effects to describe all their interactions with the external world and let the users decide how to implement those interactions. The effect interface provides a type safe communication between the library author and the library user.</p>
<p>Effects can appear in the function type but usually they are not present and are inferred by the compiler. The idea is that introducing, changing or removing an effect should not be an activity that affects all function signatures in the call chain, only the effect user and the effect handler functions are affected.</p>
<p>A simple example</p>
<pre><code class="language-Siko">
effect Log where
    log :: String -&gt; ()

someFunc :: () using (Log)
someFunc = do
    msg &lt;- &quot;Hello world&quot;
    log msg

logConsole msg = println msg

main = do
    with { log = logConsole } do
        someFunc
</code></pre>
<p>In the example above the someFunc function uses the effect called Log. In the example the effect appears in its signature but this effect declaration is fully optional, the list of used effects can be inferred by the compiler.</p>
<p>The <code>with</code> block introduces an effect handler, it specifies that the log effect call must be handled by the call logConsole for everything inside the with block (including the someFunc call).</p>
<p>Effect handlers can be static or dynamic and effects can introduce types as well.</p>
<h2 id="effect-syntax"><a class="header" href="#effect-syntax">Effect syntax</a></h2>
<h3 id="effect-definition"><a class="header" href="#effect-definition">Effect definition</a></h3>
<p>Effects are defined using the <code>effect</code> keyword, otherwise they are very similar to type class definitions. This is not a coincidence. Effects are very similar to type classes, they define an interface, however effects are not bound to types, but scopes.</p>
<p>An effect definition:</p>
<pre><code class="language-Siko">
effect (Show a) =&gt; Factory a where
    create a :: a

</code></pre>
<p>The effect above defines a factory that has a single call called <code>create</code> which can create an instance of some type a that implements the interface of the Show typeclass. The effects user does not know what the returned type of a will be, only that it can be converted into a String (using Show).</p>
<h3 id="declaring-used-effects-in-function-signatures"><a class="header" href="#declaring-used-effects-in-function-signatures">Declaring used effects in function signatures</a></h3>
<pre><code class="language-Siko">
someFunc a :: Int -&gt; String using (Factory a)
</code></pre>
<p>Effects in function signatures are declared using the <code>using</code> keyword. The type parameters of effects are part of the type parameter list of the function signature. Used effect declarations are optional part of a function signature.</p>
<h3 id="defining-handlers"><a class="header" href="#defining-handlers">Defining handlers</a></h3>
<pre><code class="language-Siko">
someFunc = do
    with { someOp = myOp } do
        otherCall
</code></pre>
<p>Effect handlers are defined using the <code>with</code> keyword, the <code>with</code> block contains a list of definitions. Each definition defines that a effect call is handled by the given handler.</p>
<h2 id="static-effects"><a class="header" href="#static-effects">Static Effects</a></h2>
<p>Static effects are effects with a statically dispatched handler, i.e. the compiler can decide, at compile time, which function will be called as the effect handler.</p>
<pre><code class="language-Siko">
import IO

effect FileOps where
    open :: String -&gt; File
    read :: File -&gt; String

someFunc :: String using (FileOps)
someFunc = do
    f &lt;- open &quot;my.txt&quot;
    read f

main = do
    with { open = IO.openFile, read = IO.readFile } do
        println someFunc
</code></pre>
<p>In the above example, the <code>open</code> is defined to be handled by <code>IO.openFile</code> which is a statically known function's name without any argument, so the effect handler does not have any associated environment. Thus, this call can be statically dispatched, i.e. the <code>open</code> call in <code>someFunc</code> can be simply replaced by <code>IO.openFile</code> in the generated code. This type of effect call has zero runtime overhead, it is essentially a type safe search and replace.</p>
<h2 id="dynamic-effects"><a class="header" href="#dynamic-effects">Dynamic Effects</a></h2>
<p>Dynamic effects are effects with a runtime defined environment attached to the handler. In these cases, the compiler can not statically dispatch the handler at compile time.</p>
<pre><code class="language-Siko">
import IO

data Config = Config String

effect ConfigProvider where
    get :: () -&gt; Config

someFunc :: String using (ConfigProvider)
someFunc = do
    Config c &lt;- get ()
    c

main = do
    config &lt;- Config &quot;myConfig&quot;
    with { get = \_ -&gt; config } do
        println someFunc
</code></pre>
<p>In the above example, the <code>get</code> is defined to be handled by a closure which is a runtime defined entity with an associated environment (contains the value of config). Thus, this call can only be dynamically dispatched. In this scenario, the compiler injects the closure as a hidden argument to all affected function, i.e. <code>someFunc</code> will have an extra parameter that contains the closure which will be called by the <code>get</code> call at runtime.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="type_classes.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="memory.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="type_classes.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="memory.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="src/custom-highlight.js"></script>


    </body>
</html>
